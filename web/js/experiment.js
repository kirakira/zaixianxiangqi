var $jscomp={scope:{},getGlobal:function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global?global:a}};$jscomp.global=$jscomp.getGlobal(this);$jscomp.initSymbol=function(){$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol);$jscomp.initSymbol=function(){}};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return"jscomp_symbol_"+a+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();$jscomp.global.Symbol.iterator||($jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));$jscomp.initSymbolIterator=function(){}};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();if(a[$jscomp.global.Symbol.iterator])return a[$jscomp.global.Symbol.iterator]();var b=0;return{next:function(){return b==a.length?{done:!0}:{done:!1,value:a[b++]}}}};
$jscomp.arrayFromIterator=function(a){for(var b,d=[];!(b=a.next()).done;)d.push(b.value);return d};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};
$jscomp.inherits=function(a,b){function d(){}d.prototype=b.prototype;a.prototype=new d;a.prototype.constructor=a;for(var c in b)if($jscomp.global.Object.defineProperties){var e=$jscomp.global.Object.getOwnPropertyDescriptor(b,c);e&&$jscomp.global.Object.defineProperty(a,c,e)}else a[c]=b[c]};$jscomp.array=$jscomp.array||{};$jscomp.array.done_=function(){return{done:!0,value:void 0}};
$jscomp.array.arrayIterator_=function(a,b){a instanceof String&&(a=String(a));var d=0;$jscomp.initSymbol();$jscomp.initSymbolIterator();var c={},e=(c.next=function(){if(d<a.length){var c=d++;return{value:b(c,a[c]),done:!1}}e.next=$jscomp.array.done_;return $jscomp.array.done_()},c[Symbol.iterator]=function(){return e},c);return e};
$jscomp.array.findInternal_=function(a,b,d){a instanceof String&&(a=String(a));for(var c=a.length,e=0;e<c;e++){var g=a[e];if(b.call(d,g,e,a))return{i:e,v:g}}return{i:-1,v:void 0}};
$jscomp.array.from=function(a,b,d){b=void 0===b?function(a){return a}:b;var c=[];$jscomp.initSymbol();$jscomp.initSymbolIterator();if(a[Symbol.iterator]){$jscomp.initSymbol();$jscomp.initSymbolIterator();a=a[Symbol.iterator]();for(var e;!(e=a.next()).done;)c.push(b.call(d,e.value))}else{e=a.length;for(var g=0;g<e;g++)c.push(b.call(d,a[g]))}return c};$jscomp.array.of=function(a){for(var b=[],d=0;d<arguments.length;++d)b[d-0]=arguments[d];return $jscomp.array.from(b)};
$jscomp.array.entries=function(){return $jscomp.array.arrayIterator_(this,function(a,b){return[a,b]})};$jscomp.array.installHelper_=function(a,b){!Array.prototype[a]&&Object.defineProperties&&Object.defineProperty&&Object.defineProperty(Array.prototype,a,{configurable:!0,enumerable:!1,writable:!0,value:b})};$jscomp.array.entries$install=function(){$jscomp.array.installHelper_("entries",$jscomp.array.entries)};$jscomp.array.keys=function(){return $jscomp.array.arrayIterator_(this,function(a){return a})};
$jscomp.array.keys$install=function(){$jscomp.array.installHelper_("keys",$jscomp.array.keys)};$jscomp.array.values=function(){return $jscomp.array.arrayIterator_(this,function(a,b){return b})};$jscomp.array.values$install=function(){$jscomp.array.installHelper_("values",$jscomp.array.values)};
$jscomp.array.copyWithin=function(a,b,d){var c=this.length;a=Number(a);b=Number(b);d=Number(null!=d?d:c);if(a<b)for(d=Math.min(d,c);b<d;)b in this?this[a++]=this[b++]:(delete this[a++],b++);else for(d=Math.min(d,c+b-a),a+=d-b;d>b;)--d in this?this[--a]=this[d]:delete this[a];return this};$jscomp.array.copyWithin$install=function(){$jscomp.array.installHelper_("copyWithin",$jscomp.array.copyWithin)};
$jscomp.array.fill=function(a,b,d){null!=d&&a.length||(d=this.length||0);d=Number(d);for(b=Number((void 0===b?0:b)||0);b<d;b++)this[b]=a;return this};$jscomp.array.fill$install=function(){$jscomp.array.installHelper_("fill",$jscomp.array.fill)};$jscomp.array.find=function(a,b){return $jscomp.array.findInternal_(this,a,b).v};$jscomp.array.find$install=function(){$jscomp.array.installHelper_("find",$jscomp.array.find)};
$jscomp.array.findIndex=function(a,b){return $jscomp.array.findInternal_(this,a,b).i};$jscomp.array.findIndex$install=function(){$jscomp.array.installHelper_("findIndex",$jscomp.array.findIndex)};$jscomp.Map=function(a){a=void 0===a?[]:a;this.data_={};this.head_=$jscomp.Map.createHead_();this.size=0;if(a){a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next())b=b.value,this.set(b[0],b[1])}};
$jscomp.Map.checkBrowserConformance_=function(){var a=$jscomp.global.Map;if(!a||!a.prototype.entries||!Object.seal)return!1;try{var b=Object.seal({x:4}),d=new a($jscomp.makeIterator([[b,"s"]]));if("s"!=d.get(b)||1!=d.size||d.get({x:4})||d.set({x:4},"t")!=d||2!=d.size)return!1;var c=d.entries(),e=c.next();if(e.done||e.value[0]!=b||"s"!=e.value[1])return!1;e=c.next();return e.done||4!=e.value[0].x||"t"!=e.value[1]||!c.next().done?!1:!0}catch(g){return!1}};
$jscomp.Map.createHead_=function(){var a={};return a.previous=a.next=a.head=a};$jscomp.Map.getId_=function(a){if(!(a instanceof Object))return String(a);$jscomp.Map.key_ in a||a instanceof Object&&Object.isExtensible&&Object.isExtensible(a)&&$jscomp.Map.defineProperty_(a,$jscomp.Map.key_,++$jscomp.Map.index_);return $jscomp.Map.key_ in a?a[$jscomp.Map.key_]:" "+a};
$jscomp.Map.prototype.set=function(a,b){var d=this.maybeGetEntry_(a),c=d.id,e=d.list,d=d.entry;e||(e=this.data_[c]=[]);d?d.value=b:(d={next:this.head_,previous:this.head_.previous,head:this.head_,key:a,value:b},e.push(d),this.head_.previous.next=d,this.head_.previous=d,this.size++);return this};
$jscomp.Map.prototype["delete"]=function(a){var b=this.maybeGetEntry_(a);a=b.id;var d=b.list,c=b.index;return(b=b.entry)&&d?(d.splice(c,1),d.length||delete this.data_[a],b.previous.next=b.next,b.next.previous=b.previous,b.head=null,this.size--,!0):!1};$jscomp.Map.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=$jscomp.Map.createHead_();this.size=0};$jscomp.Map.prototype.has=function(a){return!!this.maybeGetEntry_(a).entry};
$jscomp.Map.prototype.get=function(a){return(a=this.maybeGetEntry_(a).entry)&&a.value};$jscomp.Map.prototype.maybeGetEntry_=function(a){var b=$jscomp.Map.getId_(a),d=this.data_[b];if(d)for(var c=0;c<d.length;c++){var e=d[c];if(a!==a&&e.key!==e.key||a===e.key)return{id:b,list:d,index:c,entry:e}}return{id:b,list:d,index:-1,entry:void 0}};$jscomp.Map.prototype.entries=function(){return this.iter_(function(a){return[a.key,a.value]})};$jscomp.Map.prototype.keys=function(){return this.iter_(function(a){return a.key})};
$jscomp.Map.prototype.values=function(){return this.iter_(function(a){return a.value})};$jscomp.Map.prototype.forEach=function(a,b){for(var d=$jscomp.makeIterator(this.entries()),c=d.next();!c.done;c=d.next())c=c.value,a.call(b,c[1],c[0],this)};
$jscomp.Map.prototype.iter_=function(a){var b=this,d=this.head_;$jscomp.initSymbol();$jscomp.initSymbolIterator();var c={};return c.next=function(){if(d){for(;d.head!=b.head_;)d=d.previous;for(;d.next!=d.head;)return d=d.next,{done:!1,value:a(d)};d=null}return{done:!0,value:void 0}},c[Symbol.iterator]=function(){return this},c};$jscomp.Map.index_=0;$jscomp.Map.defineProperty_=Object.defineProperty?function(a,b,d){Object.defineProperty(a,b,{value:String(d)})}:function(a,b,d){a[b]=String(d)};
$jscomp.Map.Entry_=function(){};$jscomp.Map.ASSUME_NO_NATIVE=!1;$jscomp.Map$install=function(){$jscomp.initSymbol();$jscomp.initSymbolIterator();!$jscomp.Map.ASSUME_NO_NATIVE&&$jscomp.Map.checkBrowserConformance_()?$jscomp.Map=$jscomp.global.Map:($jscomp.initSymbol(),$jscomp.initSymbolIterator(),$jscomp.Map.prototype[Symbol.iterator]=$jscomp.Map.prototype.entries,$jscomp.initSymbol(),$jscomp.Map.key_=Symbol("map-id-key"));$jscomp.Map$install=function(){}};$jscomp.math=$jscomp.math||{};
$jscomp.math.clz32=function(a){a=Number(a)>>>0;if(0===a)return 32;var b=0;0===(a&4294901760)&&(a<<=16,b+=16);0===(a&4278190080)&&(a<<=8,b+=8);0===(a&4026531840)&&(a<<=4,b+=4);0===(a&3221225472)&&(a<<=2,b+=2);0===(a&2147483648)&&b++;return b};$jscomp.math.imul=function(a,b){a=Number(a);b=Number(b);var d=a&65535,c=b&65535;return d*c+((a>>>16&65535)*c+d*(b>>>16&65535)<<16>>>0)|0};$jscomp.math.sign=function(a){a=Number(a);return 0===a||isNaN(a)?a:0<a?1:-1};
$jscomp.math.log10=function(a){return Math.log(a)/Math.LN10};$jscomp.math.log2=function(a){return Math.log(a)/Math.LN2};$jscomp.math.log1p=function(a){a=Number(a);if(.25>a&&-.25<a){for(var b=a,d=1,c=a,e=0,g=1;e!=c;)b*=a,g*=-1,c=(e=c)+g*b/++d;return c}return Math.log(1+a)};$jscomp.math.expm1=function(a){a=Number(a);if(.25>a&&-.25<a){for(var b=a,d=1,c=a,e=0;e!=c;)b*=a/++d,c=(e=c)+b;return c}return Math.exp(a)-1};$jscomp.math.cosh=function(a){a=Number(a);return(Math.exp(a)+Math.exp(-a))/2};
$jscomp.math.sinh=function(a){a=Number(a);return 0===a?a:(Math.exp(a)-Math.exp(-a))/2};$jscomp.math.tanh=function(a){a=Number(a);if(0===a)return a;var b=Math.exp(2*-Math.abs(a)),b=(1-b)/(1+b);return 0>a?-b:b};$jscomp.math.acosh=function(a){a=Number(a);return Math.log(a+Math.sqrt(a*a-1))};$jscomp.math.asinh=function(a){a=Number(a);if(0===a)return a;var b=Math.log(Math.abs(a)+Math.sqrt(a*a+1));return 0>a?-b:b};
$jscomp.math.atanh=function(a){a=Number(a);return($jscomp.math.log1p(a)-$jscomp.math.log1p(-a))/2};
$jscomp.math.hypot=function(a,b,d){for(var c=[],e=2;e<arguments.length;++e)c[e-2]=arguments[e];a=Number(a);b=Number(b);for(var g=Math.max(Math.abs(a),Math.abs(b)),k=$jscomp.makeIterator(c),e=k.next();!e.done;e=k.next())g=Math.max(g,Math.abs(e.value));if(1E100<g||1E-100>g){a/=g;b/=g;k=a*a+b*b;c=$jscomp.makeIterator(c);for(e=c.next();!e.done;e=c.next())e=e.value,e=Number(e)/g,k+=e*e;return Math.sqrt(k)*g}g=a*a+b*b;c=$jscomp.makeIterator(c);for(e=c.next();!e.done;e=c.next())e=e.value,e=Number(e),g+=
e*e;return Math.sqrt(g)};$jscomp.math.trunc=function(a){a=Number(a);if(isNaN(a)||Infinity===a||-Infinity===a||0===a)return a;var b=Math.floor(Math.abs(a));return 0>a?-b:b};$jscomp.math.cbrt=function(a){if(0===a)return a;a=Number(a);var b=Math.pow(Math.abs(a),1/3);return 0>a?-b:b};$jscomp.number=$jscomp.number||{};$jscomp.number.isFinite=function(a){return"number"!==typeof a?!1:!isNaN(a)&&Infinity!==a&&-Infinity!==a};
$jscomp.number.isInteger=function(a){return $jscomp.number.isFinite(a)?a===Math.floor(a):!1};$jscomp.number.isNaN=function(a){return"number"===typeof a&&isNaN(a)};$jscomp.number.isSafeInteger=function(a){return $jscomp.number.isInteger(a)&&Math.abs(a)<=$jscomp.number.MAX_SAFE_INTEGER};$jscomp.number.EPSILON=Math.pow(2,-52);$jscomp.number.MAX_SAFE_INTEGER=9007199254740991;$jscomp.number.MIN_SAFE_INTEGER=-9007199254740991;$jscomp.object=$jscomp.object||{};
$jscomp.object.assign=function(a,b){for(var d=[],c=1;c<arguments.length;++c)d[c-1]=arguments[c];d=$jscomp.makeIterator(d);for(c=d.next();!c.done;c=d.next())if(c=c.value)for(var e in c)Object.prototype.hasOwnProperty.call(c,e)&&(a[e]=c[e]);return a};$jscomp.object.is=function(a,b){return a===b?0!==a||1/a===1/b:a!==a&&b!==b};$jscomp.Set=function(a){a=void 0===a?[]:a;this.map_=new $jscomp.Map;if(a){a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next())this.add(b.value)}this.size=this.map_.size};
$jscomp.Set.checkBrowserConformance_=function(){var a=$jscomp.global.Set;if(!a||!a.prototype.entries||!Object.seal)return!1;var b=Object.seal({x:4}),a=new a($jscomp.makeIterator([b]));if(a.has(b)||1!=a.size||a.add(b)!=a||1!=a.size||a.add({x:4})!=a||2!=a.size)return!1;var a=a.entries(),d=a.next();if(d.done||d.value[0]!=b||d.value[1]!=b)return!1;d=a.next();return d.done||d.value[0]==b||4!=d.value[0].x||d.value[1]!=d.value[0]?!1:a.next().done};
$jscomp.Set.prototype.add=function(a){this.map_.set(a,a);this.size=this.map_.size;return this};$jscomp.Set.prototype["delete"]=function(a){a=this.map_["delete"](a);this.size=this.map_.size;return a};$jscomp.Set.prototype.clear=function(){this.map_.clear();this.size=0};$jscomp.Set.prototype.has=function(a){return this.map_.has(a)};$jscomp.Set.prototype.entries=function(){return this.map_.entries()};$jscomp.Set.prototype.values=function(){return this.map_.values()};
$jscomp.Set.prototype.forEach=function(a,b){var d=this;this.map_.forEach(function(c){return a.call(b,c,c,d)})};$jscomp.Set.ASSUME_NO_NATIVE=!1;$jscomp.Set$install=function(){!$jscomp.Set.ASSUME_NO_NATIVE&&$jscomp.Set.checkBrowserConformance_()?$jscomp.Set=$jscomp.global.Set:($jscomp.Map$install(),$jscomp.initSymbol(),$jscomp.initSymbolIterator(),$jscomp.Set.prototype[Symbol.iterator]=$jscomp.Set.prototype.values);$jscomp.Set$install=function(){}};$jscomp.string=$jscomp.string||{};
$jscomp.string.noNullOrUndefined_=function(a,b){if(null==a)throw new TypeError("The 'this' value for String.prototype."+b+" must not be null or undefined");};$jscomp.string.noRegExp_=function(a,b){if(a instanceof RegExp)throw new TypeError("First argument to String.prototype."+b+" must not be a regular expression");};
$jscomp.string.fromCodePoint=function(a){for(var b=[],d=0;d<arguments.length;++d)b[d-0]=arguments[d];for(var d="",b=$jscomp.makeIterator(b),c=b.next();!c.done;c=b.next()){c=c.value;c=+c;if(0>c||1114111<c||c!==Math.floor(c))throw new RangeError("invalid_code_point "+c);65535>=c?d+=String.fromCharCode(c):(c-=65536,d+=String.fromCharCode(c>>>10&1023|55296),d+=String.fromCharCode(c&1023|56320))}return d};
$jscomp.string.repeat=function(a){$jscomp.string.noNullOrUndefined_(this,"repeat");var b=String(this);if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var d="";a;)if(a&1&&(d+=b),a>>>=1)b+=b;return d};$jscomp.string.repeat$install=function(){String.prototype.repeat||(String.prototype.repeat=$jscomp.string.repeat)};
$jscomp.string.codePointAt=function(a){$jscomp.string.noNullOrUndefined_(this,"codePointAt");var b=String(this),d=b.length;a=Number(a)||0;if(0<=a&&a<d){a|=0;var c=b.charCodeAt(a);if(55296>c||56319<c||a+1===d)return c;a=b.charCodeAt(a+1);return 56320>a||57343<a?c:1024*(c-55296)+a+9216}};$jscomp.string.codePointAt$install=function(){String.prototype.codePointAt||(String.prototype.codePointAt=$jscomp.string.codePointAt)};
$jscomp.string.includes=function(a,b){b=void 0===b?0:b;$jscomp.string.noRegExp_(a,"includes");$jscomp.string.noNullOrUndefined_(this,"includes");return-1!==String(this).indexOf(a,b)};$jscomp.string.includes$install=function(){String.prototype.includes||(String.prototype.includes=$jscomp.string.includes)};
$jscomp.string.startsWith=function(a,b){b=void 0===b?0:b;$jscomp.string.noRegExp_(a,"startsWith");$jscomp.string.noNullOrUndefined_(this,"startsWith");var d=String(this);a+="";for(var c=d.length,e=a.length,g=Math.max(0,Math.min(b|0,d.length)),k=0;k<e&&g<c;)if(d[g++]!=a[k++])return!1;return k>=e};$jscomp.string.startsWith$install=function(){String.prototype.startsWith||(String.prototype.startsWith=$jscomp.string.startsWith)};
$jscomp.string.endsWith=function(a,b){$jscomp.string.noRegExp_(a,"endsWith");$jscomp.string.noNullOrUndefined_(this,"endsWith");var d=String(this);a+="";void 0===b&&(b=d.length);for(var c=Math.max(0,Math.min(b|0,d.length)),e=a.length;0<e&&0<c;)if(d[--c]!=a[--e])return!1;return 0>=e};$jscomp.string.endsWith$install=function(){String.prototype.endsWith||(String.prototype.endsWith=$jscomp.string.endsWith)};
function parseMoves(a){a=a.split("/");for(var b=[],d=1;d<a.length;++d){var c=a[d];if("R"==c||"B"==c||"D"==c)break;b.push([parseInt(c[0],10),parseInt(c[1],10),parseInt(c[2],10),parseInt(c[3],10)])}return b}function removeAllChildren(a){for(a=document.getElementById(a);a.lastChild;)a.removeChild(a.lastChild)}
function createLink(a,b,d,c,e){var g=document.createElement("a");a&&(g.id=a);b.forEach(function(a){g.classList.add(a)});g.href=d;c&&(g.onclick=c);g.appendChild(document.createTextNode(e));return g}String.prototype.endsWith||(String.prototype.endsWith=function(a,b){var d=this.toString();if(void 0===b||b>d.length)b=d.length;b-=a.length;d=d.indexOf(a,b);return-1!==d&&d===b});
function ajax(a,b,d,c,e,g){var k=new XMLHttpRequest;k.onreadystatechange=function(){4==k.readyState&&(200<=k.status&&299>=k.status?e(k.responseText):g(k.responseText))};k.open(a,b,!0);d&&k.setRequestHeader("Content-type",d);c?k.send(c):k.send()}function ajaxGet(a,b,d){ajax("GET",a,void 0,void 0,b,d)}function ajaxPost(a,b,d,c){ajax("POST",a,"application/x-www-form-urlencoded; charset=UTF-8",b,d,c)}
function enableLink(a,b){var d=document.getElementById(a);b?d.classList.remove("disabled"):d.classList.add("disabled")}function getCookie(a){a+="=";for(var b=document.cookie.split(";"),d=0;d<b.length;++d){for(var c=b[d];" "==c.charAt(0);)c=c.substring(1);if(0==c.indexOf(a))return c.substring(a.length,c.length)}return""}function getSid(){return getCookie("sid")}function setSpanText(a,b){removeAllChildren(a);document.getElementById(a).appendChild(document.createTextNode(b))}
function getTextWidth(a,b){var d=(getTextWidth.canvas||(getTextWidth.canvas=document.createElement("canvas"))).getContext("2d");d.font=b;return d.measureText(a).width};var PIECE_NONE=0,PIECE_K=1,PIECE_A=2,PIECE_E=3,PIECE_H=4,PIECE_R=5,PIECE_C=6,PIECE_P=7,PIECE_BK=1,PIECE_BA=2,PIECE_BE=3,PIECE_BH=4,PIECE_BR=5,PIECE_BC=6,PIECE_BP=7,PIECE_RK=9,PIECE_RA=10,PIECE_RE=11,PIECE_RH=12,PIECE_RR=13,PIECE_RC=14,PIECE_RP=15;function isRedPiece(a){return 8<=a}function Move(a,b,d,c,e,g){this.i1=a;this.j1=b;this.i2=d;this.j2=c;this.piece=e||PIECE_NONE;this.capture=g||PIECE_NONE}
function Chess(a){function b(){return 0==l.length%2}function d(a){return 8<=a?a-8:a}function c(a){var b=a.split("/");if(10!=b.length)throw"Malformed fen string: "+a;for(var d=0;10>d;++d)for(var c=0,e=0;e<b[d].length;++e){if(9<=c)throw"Malformed fen string at row "+d+": "+a;var f=b[d][e];if("0"<=f&&"9">=f)c+=parseInt(b[d][e],10);else{var f=m[d],l=c,p=b[d][e],C=p==p.toLowerCase(),p=p.toLowerCase(),g=0;"k"==p?g=1:"a"==p?g=2:"e"==p?g=3:"h"==p?g=4:"r"==p?g=5:"c"==p?g=6:"p"==p&&(g=7);C||(g+=8);f[l]=g;++c}}}
function e(){m=[];l=[];for(var b=0;10>b;++b){m.push([]);for(var q=0;9>q;++q)m[b].push(0)}a?c(a):c("rheakaehr/9/1c5c1/p1p1p1p1p/9/9/P1P1P1P1P/1C5C1/9/RHEAKAEHR")}function g(a,b,d,c){l.push(new Move(a,b,d,c,m[a][b],m[d][c]));m[d][c]=m[a][b];m[a][b]=0;return l[l.length-1]}function k(){var a=l.pop();m[a.i1][a.j1]=m[a.i2][a.j2];m[a.i2][a.j2]=a.capture}function h(a,b){return 0<=a&&10>a&&0<=b&&9>b}function n(a,b){return 3<=b&&5>=b&&(0<=a&&2>=a||7<=a&&9>=a)}function w(a,b){for(var c=[],z=0;4>z;++z)n(a+C[z],
b+p[z])&&c.push(new Move(a,b,a+C[z],b+p[z]));for(z=-1;1>=z;z+=2)for(var e=a+z;0<=e&&10>e&&(d(m[e][b])==PIECE_K&&c.push(new Move(a,b,e,b)),0==m[e][b]);e+=z);return c}function D(a,b){for(var d=[],c=0;4>c;++c)n(a+A[c],b+B[c])&&d.push(new Move(a,b,a+A[c],b+B[c]));return d}function x(a,b){for(var d=[],c=0;4>c;++c)h(a+2*A[c],b+2*B[c])&&0==m[a+A[c]][b+B[c]]&&4<a+A[c]&&d.push(new Move(a,b,a+2*A[c],b+2*B[c]));return d}function r(a,b){for(var d=[],c=0;4>c;++c)!h(a+2*A[c],b+2*B[c])||0!=m[a+A[c]][b+B[c]]||4<
a+A[c]||d.push(new Move(a,b,a+2*A[c],b+2*B[c]));return d}function f(a,b){var d=[];[[1,2,0,1],[1,-2,0,-1],[-1,2,0,1],[-1,-2,0,-1],[2,1,1,0],[2,-1,1,0],[-2,1,-1,0],[-2,-1,-1,0]].forEach(function(c){h(a+c[0],b+c[1])&&0==m[a+c[2]][b+c[3]]&&d.push(new Move(a,b,a+c[0],b+c[1]))});return d}function u(a,b){for(var d=[],c=0;4>c;++c){var e,f;e=a+C[c];for(f=b+p[c];h(e,f)&&(d.push(new Move(a,b,e,f)),0==m[e][f]);e+=C[c],f+=p[c]);}return d}function F(a,b){for(var d=[],c=0;4>c;++c){var e,f,l=!1;e=a+C[c];for(f=b+
p[c];h(e,f);e+=C[c],f+=p[c])if(!l&&0==m[e][f])d.push(new Move(a,b,e,f));else if(!l&&0!=m[e][f])l=!0;else if(l&&0!=m[e][f]){d.push(new Move(a,b,e,f));break}}return d}function E(a,b){var c=[];4<a?c.push(new Move(a,b,a-1,b)):(h(a-1,b)&&c.push(new Move(a,b,a-1,b)),h(a,b-1)&&c.push(new Move(a,b,a,b-1)),h(a,b+1)&&c.push(new Move(a,b,a,b+1)));return c}function G(a,b){var c=[];4<a?(h(a+1,b)&&c.push(new Move(a,b,a+1,b)),h(a,b-1)&&c.push(new Move(a,b,a,b-1)),h(a,b+1)&&c.push(new Move(a,b,a,b+1))):c.push(new Move(a,
b,a+1,b));return c}function y(a,b,c){var e=d(m[a][b]),l=isRedPiece(m[a][b]),p=[];1==e?p=w(a,b):2==e?p=D(a,b):3==e?p=l?x(a,b):r(a,b):4==e?p=f(a,b):5==e?p=u(a,b):6==e?p=F(a,b):7==e&&(p=l?E(a,b):G(a,b));p.forEach(function(a){0!=m[a.i2][a.j2]&&isRedPiece(m[a.i2][a.j2])==l||c.push(a)})}function v(a){for(var b=[],c=0;10>c;++c)for(var d=0;9>d;++d)0!=m[c][d]&&isRedPiece(m[c][d])==a&&y(c,d,b);return b}a=void 0===a?null:a;this.reset=e;this.setMoves=function(a){var b=l;e();for(var c=!0,d=0,f=0;f<a.length;++f)g(a[f][0],
a[f][1],a[f][2],a[f][3]),c&&b.length>f&&b[f].i1==a[f][0]&&b[f].j1==a[f][1]&&b[f].i2==a[f][2]&&b[f].j2==a[f][3]?++d:c=!1;return d};this.move=g;this.checkMove=function(a,c,d,e){var f=b();if(!v(f).find(function(b,f,l){return b.i1==a&&b.j1==c&&b.i2==d&&b.j2==e}))return!1;if(m[d][e]==(f?PIECE_BK:PIECE_RK))return!0;var l=!1;g(a,c,d,e);v(!f).find(function(a,b,c){return m[a.i2][a.j2]==(f?PIECE_RK:PIECE_BK)})&&(l=!0);k();return!l};this.moveHistory=function(){for(var a=[],b=0;b<l.length;++b)a.push(l[b]);return a};
this.moveHistoryArrayFormat=function(){for(var a=[],b=0;b<l.length;++b){var c=l[b];a.push([c.i1,c.j1,c.i2,c.j2])}return a};this.lastMove=function(){return l[l.length-1]};this.pieceAt=function(a,b){return m[a][b]};this.isRedNext=b;this.numMoves=function(){return l.length};this.getFen=function(){for(var a="",c=0;10>c;++c){for(var d=0;9>d;++d)if(""==m[c][d]){for(var e=d+1;9>e&&""==m[c][e];)++e;a+=""+(e-d);d=e-1}else{var e=m[c][d],f=isRedPiece(e);f&&(e-=8);var l="";1==e?l="K":2==e?l="A":3==e?l="E":4==
e?l="H":5==e?l="R":6==e?l="C":7==e&&(l="P");f||(l=l.toLowerCase());a+=l}9>c&&(a+="/")}return a+=" "+(b()?"w":"b")};var m=[],l=[];e();var C=[0,1,0,-1],p=[1,0,-1,0],A=[1,1,-1,-1],B=[1,-1,-1,1]};function BoardUI(a){function b(){return document.getElementById("board")}function d(a,b){m&&(b=8-b);return y/2+b*y}function c(a,b){m&&(a=9-a);return 5>b?y/2+a*y:y/2+a*y+v}function e(a,b,c,d,e,f){var q=document.createElementNS(E,"line");q.setAttribute("x1",a);q.setAttribute("y1",b);q.setAttribute("x2",c);q.setAttribute("y2",d);q.classList.add(e);f&&(q.id=f);return q}function g(a,b,e,f,g){var t=d(a,b);b=c(a,b);var q=document.createElementNS(E,"circle");q.setAttribute("cx",t);q.setAttribute("cy",b);
q.setAttribute("r",e);q.classList.add(f[a]);q.classList.add("piece-element");g&&(q.id=g);return q}function k(a,b){return"abcdefghi"[b]+(9-a).toString()}function h(a,b,e,f,u){u&&D(b,e);var t=void 0;u&&(t="piece-outer-"+k(b,e));var t=g(b,e,23,"piece-outer",t),q=void 0;u&&(q="piece-inner-"+k(b,e));var q=g(b,e,20,"piece-inner",q),h=G[f],z=void 0;u&&(z="piece-text-"+k(b,e));u=z;z=d(b,e);b=c(b,e);e=document.createElementNS(E,"text");e.style.fontFamily="Roboto,monospace";e.style.fontSize="24px";e.setAttribute("text-anchor",
"middle");e.setAttribute("alignment-baseline","central");e.setAttribute("dominant-baseline","middle");e.setAttribute("font-weight","bold");e.setAttribute("x",z);e.setAttribute("y",b);e.appendChild(document.createTextNode(h));e.classList.add("piece-text");e.classList.add("piece-element");e.userSelect="none";u&&(e.id=u);isRedPiece(f)?(t.setAttribute("stroke","red"),q.style.stroke="red",e.style.fill="red"):(t.style.stroke="black",q.style.stroke="black",e.style.fill="black");t.style.strokeWidth=2;q.style.strokeWidth=
2;t.style.fill="white";q.style.fillOpacity=0;a.appendChild(t);a.appendChild(q);a.appendChild(e)}function n(b,c){return function(){a(b,c)}}function w(a,b){var c=g(a,b,23,"piece-cover","piece-cover-"+k(a,b));c.style.strokeWidth=0;c.style.fillOpacity=0;c.userSelect="none";c.onmousedown=n(a,b);c.touchend=c.onmousedown;x(c)}function D(a,b){var c="piece-cover-"+k(a,b);null!=document.getElementById(c)&&r(c)}function x(a){b().appendChild(a)}function r(a){b().removeChild(document.getElementById(a))}function f(a,
b,f,g){var u;u=d(a,b);a=c(a,b);b=d(f,g);f=c(f,g);u=e(u,a,b,f,"grid",void 0);u.style.strokeWidth=1;u.style.stroke="gray";x(u)}function u(){for(i=0;9>i;++i)f(0,i,4,i),0!=i&&8!=i||f(4,i,5,i),f(5,i,9,i);for(i=0;10>i;++i)f(i,0,i,8);f(0,3,2,5);f(0,5,2,3);f(7,3,9,5);f(9,3,7,5);for(i=0;10>i;++i)for(j=0;9>j;++j)w(i,j)}function F(){for(var a=b().getElementsByClassName("highlighter");0<a.length;)b().removeChild(a[0])}this.reset=function(a){if(m==a){for(a=b().getElementsByClassName("piece-element");0<a.length;)b().removeChild(a[0]);
F()}else m=a,removeAllChildren("board"),u()};this.drawPieceWithCover=function(a,c,d){h(b(),a,c,d,!0);w(a,c)};this.erasePiece=function(a,b){D(a,b);r("piece-text-"+k(a,b));r("piece-inner-"+k(a,b));r("piece-outer-"+k(a,b));w(a,b)};this.drawColorIndicator=function(a,b){var c=1;b&&(c+=8);h(a,0,0,c,!1)};this.highlightSquare=function(a,b){var f=d(a,b),g=c(a,b),u=y/6;for(a=-1;1>=a;a+=2){var t=e(f-23,g+23*a,f-23+u,g+23*a,"highlighter",void 0);t.style.strokeWidth=2;t.style.stroke="blue";x(t);t=e(f+23-u,g+23*
a,f+23,g+23*a,"highlighter",void 0);t.style.strokeWidth=2;t.style.stroke="blue";x(t)}for(a=-1;1>=a;a+=2)t=e(f+23*a,g-23,f+23*a,g-23+u,"highlighter",void 0),t.style.strokeWidth=2,t.style.stroke="blue",x(t),t=e(f+23*a,g+23-u,f+23*a,g+23,"highlighter",void 0),t.style.strokeWidth=2,t.style.stroke="blue",x(t)};this.eraseHighlights=F;var E="http://www.w3.org/2000/svg",G=" \u5c07 \u58eb \u8c61 \u99ac \u8eca \u7832 \u5352  \u5e25 \u4ed5 \u76f8 \u508c \u4fe5 \u70ae \u5175".split(" "),y=50,v=0,m=!1;u()};function Board(a,b){function d(){for(var a=0;10>a;++a)for(var b=0;9>b;++b)h.pieceAt(a,b)!=PIECE_NONE&&n.drawPieceWithCover(a,b,h.pieceAt(a,b));r=h.numMoves()}function c(a){a=Math.max(0,a);a=Math.min(h.numMoves(),a);if(a==r)return r;var b=h.moveHistory();if(a>r)for(var c=r;c<a;++c)g(b[c]);else for(c=r-1;c>=a;--c)0<c?k(b[c],b[c-1]):k(b[c],null);return r=a}function e(a){return a==PIECE_NONE?!1:"r"==w?isRedPiece(a):"b"==w?!isRedPiece(a):!1}function g(a){n.erasePiece(a.i1,a.j1);a.capture&&n.erasePiece(a.i2,
a.j2);n.drawPieceWithCover(a.i2,a.j2,a.piece);n.eraseHighlights();n.highlightSquare(a.i1,a.j1);n.highlightSquare(a.i2,a.j2);x=null}function k(a,b){n.drawPieceWithCover(a.i1,a.j1,a.piece);n.erasePiece(a.i2,a.j2);a.capture&&n.drawPieceWithCover(a.i2,a.j2,a.capture);n.eraseHighlights();b&&(n.highlightSquare(b.i1,b.j1),n.highlightSquare(b.i2,b.j2));x=null}this.setState=function(a,b,e){a!=w&&(w=a,n.reset("b"==a),h.reset(),d(),x=null);D=b;a=h.moveHistory();e=h.setMoves(e);b=r;r==a.length&&(b=h.numMoves());
for(b=Math.min(b,h.numMoves());r>e;--r){var g=r-1;0<g?k(a[g],a[g-1]):k(a[g],null)}c(b)};this.resetState=function(a,b,c){w=a;n.reset("b"==a);h.reset();h.setMoves(c);d();x=null;r=h.numMoves();0<h.numMoves()&&(a=h.lastMove(),n.highlightSquare(a.i1,a.j1),n.highlightSquare(a.i2,a.j2))};this.showMove=c;this.isRedNext=function(){return h.isRedNext()};this.numMoves=function(){return h.numMoves()};this.numMovesShown=function(){return r};this.getFen=function(){for(var a=h.moveHistoryArrayFormat(),b=[],c=0;c<
r;++c)b.push(a[c]);h.setMoves(b);b=h.getFen();h.setMoves(a);return b};var h=new Chess(void 0===b?null:b),n=new BoardUI(function(b,c){if(!D){var d=h.isRedNext();if(("r"==w&&d||"b"==w&&!d)&&r==h.numMoves())if(x)if(h.checkMove(x[0],x[1],b,c)){var d=x[0],k=x[1];g(h.move(d,k,b,c));++r;a(d,k,b,c)}else e(h.pieceAt(b,c))&&(n.eraseHighlights(),x=[b,c],n.highlightSquare(b,c));else e(h.pieceAt(b,c))&&(n.eraseHighlights(),x=[b,c],n.highlightSquare(b,c))}}),w="r",D=!0,x=null,r=0;n.drawColorIndicator(document.getElementById("redIndicator"),
!0);n.drawColorIndicator(document.getElementById("blackIndicator"),!1);d()};function ExperimentViewer(a,b){function d(a,b,c,d){}function c(a){a=Math.min(b.length-1,a);a=Math.max(0,a);a<b.length&&e(b[a].game_id)}function e(a){var b=document.getElementById("game-record-"+a);b?(b.classList.add("pendingSelection"),g(a)):alert("Game "+a+" does not exist.")}function g(c){ajaxGet(encodeURI("/game_record/"+a.id+"/"+c),function(a){y=JSON.parse(a);v=y.game_info;m&&m.classList.remove("selectedGame");a=document.getElementById("game-record-"+c);a.classList.remove("pendingSelection");
a.classList.add("selectedGame");m=a;window.location.hash="#"+c;for(a=0;a<b.length;++a)b[a].game_id==c&&(l=a);n()},function(a,b){var c=document.getElementById("game-record-"+a);c&&c.classList.remove("pendingSelection");alert("Failed to retrieve game record")})}function k(a){return a.hasOwnProperty("control_is_red")&&a.control_is_red}function h(){for(var a=document.getElementById("gameList"),c=0;c<b.length;c++){var d=b[c],f=document.createElement("tr"),g=document.createElement("td"),h=0;d.hasOwnProperty("result")&&
(1==d.result?h=k(d)?2:1:2==d.result&&(h=k(d)?1:2));0==h?(g.appendChild(document.createTextNode("D")),g.classList.add("draw")):1==h?(g.appendChild(document.createTextNode("W")),g.classList.add("win")):(g.appendChild(document.createTextNode("L")),g.classList.add("loss"));f.appendChild(g);g=document.createElement("td");g.appendChild(document.createTextNode(d.game_id));g.onclick=function(a){return function(){e(a.game_id)}}(d);g.id="game-record-"+d.game_id;f.appendChild(g);a.appendChild(f)}}function n(){removeAllChildren("red-player");
var a=document.getElementById("red-player"),b=document.createElement("span");v&&b.appendChild(document.createTextNode(v.red.name));a.appendChild(b);removeAllChildren("black-player");a=document.getElementById("black-player");b=document.createElement("span");v&&b.appendChild(document.createTextNode(v.black.name));a.appendChild(b);board_.resetState("r",!0,parseMoves(v?v.moves:""));A=v?v.moves.length:0;removeAllChildren("gameTitle");b=document.getElementById("gameTitle");a=document.createElement("h3");
a.appendChild(document.createTextNode(v?v.title:""));b.appendChild(a);var b=document.getElementById("playingStatus"),a=document.getElementById("redWonStatus"),c=document.getElementById("blackWonStatus"),d=document.getElementById("drawStatus");b.style.display="none";a.style.display="none";c.style.display="none";d.style.display="none";v&&(v.moves.endsWith("R")?a.style.display="inline-block":v.moves.endsWith("B")?c.style.display="inline-block":v.moves.endsWith("D")?d.style.display="inline-block":b.style.display=
"inline-block");F();f(board_.numMovesShown(),!0)}function w(a,b){var c=document.createElement("td");c.appendChild(b);a.appendChild(c)}function D(){removeAllChildren("move-history");var a=document.getElementById("move-history"),b=document.createElement("table");b.id="moveHistoryControls";var c=document.createElement("tr");b.appendChild(c);0<board_.numMovesShown()?(w(c,createLink("move-history-first",[],"#",function(){f(0,!0);return!1},"first")),w(c,createLink("move-history-prev",[],"#",function(){f(board_.numMovesShown()-
1,!0);return!1},"prev"))):(w(c,document.createTextNode("first")),w(c,document.createTextNode("prev")));w(c,document.createTextNode(""+board_.numMovesShown()+" / "+board_.numMoves()));board_.numMovesShown()<board_.numMoves()?(w(c,createLink("move-history-next",[],"#",function(){f(board_.numMovesShown()+1,!0);return!1},"next")),w(c,createLink("move-history-last",[],"#",function(){f(board_.numMoves(),!0);return!1},"last"))):(w(c,document.createTextNode("next")),w(c,document.createTextNode("last")));
a.appendChild(b);a=document.getElementById("fen");removeAllChildren("fen");a.appendChild(document.createTextNode(board_.getFen()))}function x(a){for(var b=y.game_record.scores,c=[0],d=[0],e=0;e<b.length;++e)c.push(e+1),d.push(b[Math.min(b.length-1,2*Math.floor(e/2)+a)]);return{x:c,y:d,type:"scatter",hoverinfo:"y"}}function r(a){for(var b=y.game_record.output,c=[0],d=[0],e=0;e<b.length;++e)c.push(e+1),d.push(b[Math.min(b.length-1,2*Math.floor(e/2)+a)].last_complete_depth.depth);return{x:c,y:d,type:"scatter",
hoverinfo:"y"}}function f(a,b){movesToShow=board_.showMove(a);b&&(A=movesToShow);D();u();G()}function u(){if(p&&v){var a={"shapes[0].x0":A,"shapes[0].x1":A,"shapes[1].x0":board_.numMovesShown(),"shapes[1].x1":board_.numMovesShown()};["engineScoreChart","engineDepthChart"].forEach(function(b){b=document.getElementById(b);Plotly.relayout(b,a);Plotly.Fx.hover(b,[{curveNumber:0,pointNumber:board_.numMovesShown()},{curveNumber:1,pointNumber:board_.numMovesShown()}])})}}function F(){if(C&&y){var a=E,b=
x(0),c=x(1),d;d=y.game_record.scores;for(var e=[],f=0;f<d.length;++f)e.push(d[f]);2>=e.length||400>Math.abs(e[e.length-1])?d=null:(d=e.slice(0,e.length-2),d=[Math.min.apply(Math,[].concat($jscomp.arrayFromIterable(d))),Math.max.apply(Math,[].concat($jscomp.arrayFromIterable(d)))]);a("engineScoreChart","Engine scores",b,c,d);E("engineDepthChart","Engine depths",r(0),r(1),null);p=!0}}function E(a,b,c,d,e){c.name=v.red.name;d.name=v.black.name;data=k(y.game_record)?[d,c]:[c,d];b={title:b,showlegend:!0,
legend:{bgcolor:"rgba(0, 0, 0, 0)",x:0,xanchor:"left",y:1},margin:{l:20,r:20,t:40,b:40},shapes:[{type:"line",xref:"x",yref:"paper",x0:board_.numMovesShown(),x1:board_.numMovesShown(),y0:0,y1:1,fillcolor:"#121212",opacity:.4},{type:"line",xref:"x",yref:"paper",x0:board_.numMovesShown(),x1:board_.numMovesShown(),y0:0,y1:1,fillcolor:"#d3d3d3",opacity:.2,line:{dash:"dot"}}],hovermode:"x+closest"};e&&(b.yaxis={range:e});p?Plotly.react(a,data,b):(Plotly.newPlot(a,data,b,{displayModeBar:!1,responsive:!0}),
a=document.getElementById(a),a.on("plotly_hover",function(a){B||(B=!0,a=a.points[0].x,v&&1<=a&&a<=board_.numMoves()&&f(a,!1),B=!1)}),a.on("plotly_click",function(a){a=a.points[0].x;v&&1<=a&&a<=board_.numMoves()&&f(a,!0)}),a.addEventListener("mouseleave",function(a){a.relatedTarget&&!a.relatedTarget.classList.contains("dragcover")&&f(A,!1)}))}function G(){removeAllChildren("pv");if(v&&0!=board_.numMovesShown()){var a=y.game_record,b=document.getElementById("currentEngineColor");k(a)&&1==board_.numMovesShown()%
2?(b.classList.remove("engineColorTreatment"),b.classList.add("engineColorControl")):(b.classList.remove("engineColorControl"),b.classList.add("engineColorTreatment"));var a=a.output[board_.numMovesShown()-1].last_complete_depth.pv,c=document.getElementById("pv");a.forEach(function(a){var b=document.createElement("li");b.appendChild(document.createTextNode(a));c.appendChild(b)})}}var y=null,v=null,m=null,l=null,C=!1,p=!1,A=0,B=!1;this.initApplication=function(){board_=new Board(d,null);h();n();window.location.hash?
e(window.location.hash.substring(1)):0<b.length&&e(b[0].game_id);document.addEventListener("keydown",function(a){if("ArrowLeft"==a.key||"h"==a.key)return f(board_.numMovesShown()-1,!0),!1;if("ArrowRight"==a.key||"l"==a.key)return f(board_.numMovesShown()+1,!0),!1;if("PageUp"==a.key)return f(board_.numMovesShown()-10,!0),!1;if("PageDown"==a.key)return f(board_.numMovesShown()+10,!0),!1;if("Home"==a.key)return f(0,!0),!1;if("End"==a.key)return f(board_.numMoves(),!0),!1;if("ArrowUp"==a.key||"k"==a.key)return c(l-
1),!1;if("ArrowDown"==a.key||"j"==a.key)return c(l+1),!1})};this.plotlyLoaded=function(){C=!0;F()}}var recordViewer=new ExperimentViewer(experimentMetadata,toc);document.onreadystatechange=function(){"interactive"==document.readyState&&recordViewer.initApplication()};window.onload=function(){recordViewer.plotlyLoaded()};
