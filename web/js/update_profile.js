function parseMoves(a){a=a.split("/");for(var b=[],c=1;c<a.length;++c){var d=a[c];if("R"==d||"B"==d||"D"==d)break;b.push([parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10),parseInt(d[3],10)])}return b}function removeAllChildren(a){for(a=document.getElementById(a);a.lastChild;)a.removeChild(a.lastChild)}
function createLink(a,b,c,d,g){var e=document.createElement("a");a&&(e.id=a);b.forEach(function(a){e.classList.add(a)});e.href=c;d&&(e.onclick=d);e.appendChild(document.createTextNode(g));return e}String.prototype.endsWith||(String.prototype.endsWith=function(a,b){var c=this.toString();if(void 0===b||b>c.length)b=c.length;b-=a.length;c=c.indexOf(a,b);return-1!==c&&c===b});
function ajax(a,b,c,d,g,e){var f=new XMLHttpRequest;f.onreadystatechange=function(){4==f.readyState&&(200<=f.status&&299>=f.status?g(f.responseText):e(f.responseText))};f.open(a,b,!0);c&&f.setRequestHeader("Content-type",c);d?f.send(d):f.send()}function ajaxGet(a,b,c){ajax("GET",a,void 0,void 0,b,c)}function ajaxPost(a,b,c,d){ajax("POST",a,"application/x-www-form-urlencoded; charset=UTF-8",b,c,d)}
function enableLink(a,b){var c=document.getElementById(a);b?c.classList.remove("disabled"):c.classList.add("disabled")}function getCookie(a){a+="=";for(var b=document.cookie.split(";"),c=0;c<b.length;++c){for(var d=b[c];" "==d.charAt(0);)d=d.substring(1);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return""}function getSid(){return getCookie("sid")}function setSpanText(a,b){removeAllChildren(a);document.getElementById(a).appendChild(document.createTextNode(b))};function toggleMenu(){var a=document.getElementById("menu-text"),b=document.getElementById("menu-content");"grid"==b.style.display?(b.style.display="none",a.innerHTML='menu <span class="menu-toggle">[+]</span>'):(b.style.display="grid",a.innerHTML='menu <span class="menu-toggle">[-]</span>')};var inputKeyToElementId=new Map([["name",["player-name-input","player-name-validation-error"]]]),UpdateProfile=function(a){this.myUid_=a;document.getElementById("save-button").onclick=function(){this.onSave();return!1}.bind(this)};UpdateProfile.prototype.enableUI=function(a){document.getElementById("player-name-input").disabled=!a;enableLink("save-button",a)};
UpdateProfile.prototype.onSave=function(){var a=this;this.enableUI(!1);var b=["uid="+this.myUid_,"sid="+getSid()];inputKeyToElementId.forEach(function(a,c){var e=document.getElementById(a[0]).value;b.push(c+"="+encodeURIComponent(e))});var c=b.join("&");ajaxPost("/update_profile",c,function(b){b=JSON.parse(b);console.log(b);"success"==b.status?location.reload():(a.displayErrors(b),a.enableUI(!0))},function(b){a.enableUI(!0)})};
UpdateProfile.prototype.displayErrors=function(a){a.hasOwnProperty("errors")&&inputKeyToElementId.forEach(function(b,c){a.errors.hasOwnProperty(c)?setSpanText(b[1],a.errors[c]):setSpanText(b[1],"")})};document.onreadystatechange=function(){"interactive"==document.readyState&&new UpdateProfile(myUid)};
