function parseMoves(a){a=a.split("/");for(var b=[],c=1;c<a.length;++c){var f=a[c];if("R"==f||"B"==f||"D"==f)break;b.push([parseInt(f[0],10),parseInt(f[1],10),parseInt(f[2],10),parseInt(f[3],10)])}return b}function removeAllChildren(a){for(a=document.getElementById(a);a.lastChild;)a.removeChild(a.lastChild)}
function createLink(a,b,c,f,q){var m=document.createElement("a");a&&(m.id=a);b.forEach(function(b){m.classList.add(b)});m.href=c;f&&(m.onclick=f);m.appendChild(document.createTextNode(q));return m}String.prototype.endsWith||(String.prototype.endsWith=function(a,b){var c=this.toString();if(void 0===b||b>c.length)b=c.length;b-=a.length;c=c.indexOf(a,b);return-1!==c&&c===b});
function ajax(a,b,c,f,q,m){var k=new XMLHttpRequest;k.onreadystatechange=function(){4==k.readyState&&(200<=k.status&&299>=k.status?q(k.responseText):m(k.responseText))};k.open(a,b,!0);c&&k.setRequestHeader("Content-type",c);f?k.send(f):k.send()}function ajaxGet(a,b,c){ajax("GET",a,void 0,void 0,b,c)}function ajaxPost(a,b,c,f){ajax("POST",a,"application/x-www-form-urlencoded; charset=UTF-8",b,c,f)}
function enableLink(a,b){var c=document.getElementById(a);b?c.classList.remove("disabled"):c.classList.add("disabled")}function getCookie(a){a+="=";for(var b=document.cookie.split(";"),c=0;c<b.length;++c){for(var f=b[c];" "==f.charAt(0);)f=f.substring(1);if(0==f.indexOf(a))return f.substring(a.length,f.length)}return""}function getSid(){return getCookie("sid")}function setSpanText(a,b){removeAllChildren(a);document.getElementById(a).appendChild(document.createTextNode(b))};var PIECE_NONE=0,PIECE_K=1,PIECE_A=2,PIECE_E=3,PIECE_H=4,PIECE_R=5,PIECE_C=6,PIECE_P=7,PIECE_BK=1,PIECE_BA=2,PIECE_BE=3,PIECE_BH=4,PIECE_BR=5,PIECE_BC=6,PIECE_BP=7,PIECE_RK=9,PIECE_RA=10,PIECE_RE=11,PIECE_RH=12,PIECE_RR=13,PIECE_RC=14,PIECE_RP=15;function isRedPiece(a){return 8<=a}function Move(a,b,c,f,q,m){this.i1=a;this.j1=b;this.i2=c;this.j2=f;this.piece=q||PIECE_NONE;this.capture=m||PIECE_NONE}
function Chess(){function a(){return 0==v.length%2}function b(e){return 8<=e?e-8:e}function c(){p=[];v=[];for(var e=0;10>e;++e){p.push([]);for(var h=0;9>h;++h)p[e].push(0)}e="rheakaehr 9 1c5c1 p1p1p1p1p 9 9 P1P1P1P1P 1C5C1 9 RHEAKAEHR".split(" ");if(10!=e.length)throw"Malformed fen string: rheakaehr/9/1c5c1/p1p1p1p1p/9/9/P1P1P1P1P/1C5C1/9/RHEAKAEHR";for(h=0;10>h;++h)for(var b=0,d=0;d<e[h].length;++d){if(9<=b)throw"Malformed fen string at row "+h+": rheakaehr/9/1c5c1/p1p1p1p1p/9/9/P1P1P1P1P/1C5C1/9/RHEAKAEHR";
var a=e[h][d];if("0"<=a&&"9">=a)b+=parseInt(e[h][d],10);else{var a=p[h],g=b,c=e[h][d],l=c==c.toLowerCase(),c=c.toLowerCase(),n=0;"k"==c?n=1:"a"==c?n=2:"e"==c?n=3:"h"==c?n=4:"r"==c?n=5:"c"==c?n=6:"p"==c&&(n=7);l||(n+=8);a[g]=n;++b}}}function f(e,h,b,d){v.push(new Move(e,h,b,d,p[e][h],p[b][d]));p[b][d]=p[e][h];p[e][h]=0;return v[v.length-1]}function q(){var e=v.pop();p[e.i1][e.j1]=p[e.i2][e.j2];p[e.i2][e.j2]=e.capture}function m(e,h){return 0<=e&&10>e&&0<=h&&9>h}function k(e,h){return 3<=h&&5>=h&&(0<=
e&&2>=e||7<=e&&9>=e)}function g(e,h){for(var a=[],d=0;4>d;++d)k(e+z[d],h+n[d])&&a.push(new Move(e,h,e+z[d],h+n[d]));for(d=-1;1>=d;d+=2)for(var c=e+d;0<=c&&10>c&&(b(p[c][h])==PIECE_K&&a.push(new Move(e,h,c,h)),0==p[c][h]);c+=d);return a}function w(e,h){for(var b=[],d=0;4>d;++d)k(e+B[d],h+u[d])&&b.push(new Move(e,h,e+B[d],h+u[d]));return b}function A(e,h){for(var b=[],d=0;4>d;++d)m(e+2*B[d],h+2*u[d])&&0==p[e+B[d]][h+u[d]]&&4<e+B[d]&&b.push(new Move(e,h,e+2*B[d],h+2*u[d]));return b}function x(e,h){for(var b=
[],d=0;4>d;++d)!m(e+2*B[d],h+2*u[d])||0!=p[e+B[d]][h+u[d]]||4<e+B[d]||b.push(new Move(e,h,e+2*B[d],h+2*u[d]));return b}function t(e,h){var b=[];[[1,2,0,1],[1,-2,0,-1],[-1,2,0,1],[-1,-2,0,-1],[2,1,1,0],[2,-1,1,0],[-2,1,-1,0],[-2,-1,-1,0]].forEach(function(d){m(e+d[0],h+d[1])&&0==p[e+d[2]][h+d[3]]&&b.push(new Move(e,h,e+d[0],h+d[1]))});return b}function l(e,h){for(var b=[],d=0;4>d;++d){var a,c;a=e+z[d];for(c=h+n[d];m(a,c)&&(b.push(new Move(e,h,a,c)),0==p[a][c]);a+=z[d],c+=n[d]);}return b}function r(e,
h){for(var b=[],d=0;4>d;++d){var a,c,g=!1;a=e+z[d];for(c=h+n[d];m(a,c);a+=z[d],c+=n[d])if(!g&&0==p[a][c])b.push(new Move(e,h,a,c));else if(!g&&0!=p[a][c])g=!0;else if(g&&0!=p[a][c]){b.push(new Move(e,h,a,c));break}}return b}function D(e,h){var b=[];4<e?b.push(new Move(e,h,e-1,h)):(m(e-1,h)&&b.push(new Move(e,h,e-1,h)),m(e,h-1)&&b.push(new Move(e,h,e,h-1)),m(e,h+1)&&b.push(new Move(e,h,e,h+1)));return b}function y(e,b){var a=[];4<e?(m(e+1,b)&&a.push(new Move(e,b,e+1,b)),m(e,b-1)&&a.push(new Move(e,
b,e,b-1)),m(e,b+1)&&a.push(new Move(e,b,e,b+1))):a.push(new Move(e,b,e+1,b));return a}function C(e,a,c){var d=b(p[e][a]),n=isRedPiece(p[e][a]),u=[];1==d?u=g(e,a):2==d?u=w(e,a):3==d?u=n?A(e,a):x(e,a):4==d?u=t(e,a):5==d?u=l(e,a):6==d?u=r(e,a):7==d&&(u=n?D(e,a):y(e,a));u.forEach(function(b){0!=p[b.i2][b.j2]&&isRedPiece(p[b.i2][b.j2])==n||c.push(b)})}function E(b){for(var a=[],c=0;10>c;++c)for(var d=0;9>d;++d)0!=p[c][d]&&isRedPiece(p[c][d])==b&&C(c,d,a);return a}this.reset=c;this.setMoves=function(b){var a=
v;c();for(var g=!0,d=0,n=0;n<b.length;++n)f(b[n][0],b[n][1],b[n][2],b[n][3]),g&&a.length>n&&a[n].i1==b[n][0]&&a[n].j1==b[n][1]&&a[n].i2==b[n][2]&&a[n].j2==b[n][3]?++d:g=!1;return d};this.move=f;this.checkMove=function(b,c,n,d){var g=a();if(!E(g).find(function(a,g,l){return a.i1==b&&a.j1==c&&a.i2==n&&a.j2==d}))return!1;if(p[n][d]==(g?PIECE_BK:PIECE_RK))return!0;var l=!1;f(b,c,n,d);E(!g).find(function(b,a,e){return p[b.i2][b.j2]==(g?PIECE_RK:PIECE_BK)})&&(l=!0);q();return!l};this.moveHistory=function(){for(var b=
[],a=0;a<v.length;++a)b.push(v[a]);return b};this.moveHistoryArrayFormat=function(){for(var b=[],a=0;a<v.length;++a){var c=v[a];b.push([c.i1,c.j1,c.i2,c.j2])}return b};this.lastMove=function(){return v[v.length-1]};this.pieceAt=function(b,a){return p[b][a]};this.isRedNext=a;this.numMoves=function(){return v.length};this.getFen=function(){for(var b="",c=0;10>c;++c){for(var n=0;9>n;++n)if(""==p[c][n]){for(var d=n+1;9>d&&""==p[c][d];)++d;b+=""+(d-n);n=d-1}else{var d=p[c][n],g=isRedPiece(d);g&&(d-=8);
var l="";1==d?l="K":2==d?l="A":3==d?l="E":4==d?l="H":5==d?l="R":6==d?l="C":7==d&&(l="P");g||(l=l.toLowerCase());b+=l}9>c&&(b+="/")}return b+=" "+(a()?"w":"b")};var p=[],v=[];c();var z=[0,1,0,-1],n=[1,0,-1,0],B=[1,1,-1,-1],u=[1,-1,-1,1]};function BoardUI(a){function b(){return document.getElementById("board")}function c(b,a){z&&(a=8-a);return p/2+a*p}function f(b,a){z&&(b=9-b);return 5>a?p/2+b*p:p/2+b*p+v}function q(b,a,c,e,g,l){var d=document.createElementNS(C,"line");d.setAttribute("x1",b);d.setAttribute("y1",a);d.setAttribute("x2",c);d.setAttribute("y2",e);d.classList.add(g);l&&(d.id=l);return d}function m(b,a,g,e,l){var k=c(b,a);a=f(b,a);var d=document.createElementNS(C,"circle");d.setAttribute("cx",k);d.setAttribute("cy",a);
d.setAttribute("r",g);d.classList.add(e[b]);d.classList.add("piece-element");l&&(d.id=l);return d}function k(b,a){return"abcdefghi"[a]+(9-b).toString()}function g(b,a,g,e,l){l&&x(a,g);var r=void 0;l&&(r="piece-outer-"+k(a,g));var r=m(a,g,23,"piece-outer",r),d=void 0;l&&(d="piece-inner-"+k(a,g));var d=m(a,g,20,"piece-inner",d),p=E[e],w=void 0;l&&(w="piece-text-"+k(a,g));l=w;w=c(a,g);a=f(a,g);g=document.createElementNS(C,"text");g.style.fontFamily="Roboto,monospace";g.style.fontSize="24px";g.setAttribute("text-anchor",
"middle");g.setAttribute("alignment-baseline","central");g.setAttribute("dominant-baseline","middle");g.setAttribute("font-weight","bold");g.setAttribute("x",w);g.setAttribute("y",a);g.appendChild(document.createTextNode(p));g.classList.add("piece-text");g.classList.add("piece-element");g.userSelect="none";l&&(g.id=l);isRedPiece(e)?(r.setAttribute("stroke","red"),d.style.stroke="red",g.style.fill="red"):(r.style.stroke="black",d.style.stroke="black",g.style.fill="black");r.style.strokeWidth=2;d.style.strokeWidth=
2;r.style.fill="white";d.style.fillOpacity=0;b.appendChild(r);b.appendChild(d);b.appendChild(g)}function w(b,c){return function(){a(b,c)}}function A(b,a){var c=m(b,a,23,"piece-cover","piece-cover-"+k(b,a));c.style.strokeWidth=0;c.style.fillOpacity=0;c.userSelect="none";c.onmousedown=w(b,a);c.touchend=c.onmousedown;t(c)}function x(b,a){var c="piece-cover-"+k(b,a);null!=document.getElementById(c)&&l(c)}function t(a){b().appendChild(a)}function l(a){b().removeChild(document.getElementById(a))}function r(b,
a,g,e){var l;l=c(b,a);b=f(b,a);a=c(g,e);g=f(g,e);l=q(l,b,a,g,"grid",void 0);l.style.strokeWidth=1;l.style.stroke="gray";t(l)}function D(){for(i=0;9>i;++i)r(0,i,4,i),0!=i&&8!=i||r(4,i,5,i),r(5,i,9,i);for(i=0;10>i;++i)r(i,0,i,8);r(0,3,2,5);r(0,5,2,3);r(7,3,9,5);r(9,3,7,5);for(i=0;10>i;++i)for(j=0;9>j;++j)A(i,j)}function y(){for(var a=b().getElementsByClassName("highlighter");0<a.length;)b().removeChild(a[0])}this.reset=function(a){if(z==a){for(a=b().getElementsByClassName("piece-element");0<a.length;)b().removeChild(a[0]);
y()}else z=a,removeAllChildren("board"),D()};this.drawPieceWithCover=function(a,c,l){g(b(),a,c,l,!0);A(a,c)};this.erasePiece=function(a,b){x(a,b);l("piece-text-"+k(a,b));l("piece-inner-"+k(a,b));l("piece-outer-"+k(a,b));A(a,b)};this.drawColorIndicator=function(a,b){var c=1;b&&(c+=8);g(a,0,0,c,!1)};this.highlightSquare=function(a,b){var g=c(a,b),e=f(a,b),l=p/6;for(a=-1;1>=a;a+=2){var r=q(g-23,e+23*a,g-23+l,e+23*a,"highlighter",void 0);r.style.strokeWidth=2;r.style.stroke="blue";t(r);r=q(g+23-l,e+23*
a,g+23,e+23*a,"highlighter",void 0);r.style.strokeWidth=2;r.style.stroke="blue";t(r)}for(a=-1;1>=a;a+=2)r=q(g+23*a,e-23,g+23*a,e-23+l,"highlighter",void 0),r.style.strokeWidth=2,r.style.stroke="blue",t(r),r=q(g+23*a,e+23-l,g+23*a,e+23,"highlighter",void 0),r.style.strokeWidth=2,r.style.stroke="blue",t(r)};this.eraseHighlights=y;var C="http://www.w3.org/2000/svg",E=" \u5c07 \u58eb \u8c61 \u99ac \u8eca \u7832 \u5352  \u5e25 \u4ed5 \u76f8 \u508c \u4fe5 \u70ae \u5175".split(" "),p=50,v=0,z=!1;D()};function Board(a){function b(){for(var a=0;10>a;++a)for(var b=0;9>b;++b)k.pieceAt(a,b)!=PIECE_NONE&&g.drawPieceWithCover(a,b,k.pieceAt(a,b));t=k.numMoves()}function c(a){a=Math.max(0,a);a=Math.min(k.numMoves(),a);if(a==t)return t;var b=k.moveHistory();if(a>t)for(var c=t;c<a;++c)q(b[c]);else for(c=t-1;c>=a;--c)0<c?m(b[c],b[c-1]):m(b[c],null);return t=a}function f(a){return a==PIECE_NONE?!1:"r"==w?isRedPiece(a):"b"==w?!isRedPiece(a):!1}function q(a){g.erasePiece(a.i1,a.j1);a.capture&&g.erasePiece(a.i2,
a.j2);g.drawPieceWithCover(a.i2,a.j2,a.piece);g.eraseHighlights();g.highlightSquare(a.i1,a.j1);g.highlightSquare(a.i2,a.j2);x=null}function m(a,b){g.drawPieceWithCover(a.i1,a.j1,a.piece);g.erasePiece(a.i2,a.j2);a.capture&&g.drawPieceWithCover(a.i2,a.j2,a.capture);g.eraseHighlights();b&&(g.highlightSquare(b.i1,b.j1),g.highlightSquare(b.i2,b.j2));x=null}this.setState=function(a,f,q){a!=w&&(w=a,g.reset("b"==a),k.reset(),b(),x=null);A=f;a=k.moveHistory();q=k.setMoves(q);f=t;t==a.length&&(f=k.numMoves());
for(f=Math.min(f,k.numMoves());t>q;--t){var y=t-1;0<y?m(a[y],a[y-1]):m(a[y],null)}c(f)};this.resetState=function(a,c,f){w=a;g.reset("b"==a);k.reset();k.setMoves(f);b();x=null;t=k.numMoves();0<k.numMoves()&&(a=k.lastMove(),g.highlightSquare(a.i1,a.j1),g.highlightSquare(a.i2,a.j2))};this.showMove=c;this.isRedNext=function(){return k.isRedNext()};this.numMoves=function(){return k.numMoves()};this.numMovesShown=function(){return t};this.getFen=function(){for(var a=k.moveHistoryArrayFormat(),b=[],c=0;c<
t;++c)b.push(a[c]);k.setMoves(b);b=k.getFen();k.setMoves(a);return b};var k=new Chess,g=new BoardUI(function(b,c){if(!A){var m=k.isRedNext();if(("r"==w&&m||"b"==w&&!m)&&t==k.numMoves())if(x)if(k.checkMove(x[0],x[1],b,c)){var m=x[0],y=x[1];q(k.move(m,y,b,c));++t;a(m,y,b,c)}else f(k.pieceAt(b,c))&&(g.eraseHighlights(),x=[b,c],g.highlightSquare(b,c));else f(k.pieceAt(b,c))&&(g.eraseHighlights(),x=[b,c],g.highlightSquare(b,c))}}),w="r",A=!0,x=null,t=0;g.drawColorIndicator(document.getElementById("redIndicator"),
!0);g.drawColorIndicator(document.getElementById("blackIndicator"),!1);b()};function Stopwatch(a){function b(){return document.getElementById(a)}function c(){if(m){var b=document.getElementById(a+"Hand"),c=.8*q,A=k/f*2*Math.PI;b.setAttribute("x2",c*Math.sin(A));b.setAttribute("y2",-c*Math.cos(A));++k;k%=f}}this.start=function(){m||(m=!0,k=0,c(),b().style.visibility="visible")};this.stop=function(){m=!1;b().style.visibility="hidden"};this.tick=c;this.frequency=function(){return f};var f=60,q=20,m=!1,k=0;(function(){var c=document.createElementNS("http://www.w3.org/2000/svg",
"circle");c.setAttribute("cx",0);c.setAttribute("cy",0);c.setAttribute("r",q);c.style.stroke="black";c.style.strokeWidth=2;c.style.fillOpacity=0;b().appendChild(c);c=document.createElementNS("http://www.w3.org/2000/svg","line");c.setAttribute("x1",0);c.setAttribute("y1",-q);c.setAttribute("x2",0);c.setAttribute("y2",-q-6);c.style.strokeWidth=4;c.style.stroke="black";b().appendChild(c);c=document.createElementNS("http://www.w3.org/2000/svg","rect");c.setAttribute("x",-3);c.setAttribute("y",-q-6-4);
c.setAttribute("width",6);c.setAttribute("height",4);c.style.strokeWidth=.5;c.style.stroke="black";c.style.fillOpacity=0;b().appendChild(c);c=document.createElementNS("http://www.w3.org/2000/svg","circle");c.setAttribute("cx",0);c.setAttribute("cy",-q-6-2);c.setAttribute("r",6);c.style.stroke="black";c.style.strokeWidth=1;c.style.fillOpacity=0;b().appendChild(c);for(c=-3;3>=c;c+=1){var f=document.createElementNS("http://www.w3.org/2000/svg","line");f.setAttribute("x1",c);f.setAttribute("y1",-q-6-
4);f.setAttribute("x2",c);f.setAttribute("y2",-q-6);f.style.strokeWidth=.2;f.style.stroke="black";b().appendChild(f)}for(c=0;12>c;++c){var f=document.createElementNS("http://www.w3.org/2000/svg","line"),k=c/12*2*Math.PI,m=q,t=.7*q;f.setAttribute("x1",m*Math.sin(k));f.setAttribute("y1",-m*Math.cos(k));f.setAttribute("x2",t*Math.sin(k));f.setAttribute("y2",-t*Math.cos(k));f.style.strokeWidth=1;f.style.stroke="black";b().appendChild(f)}for(c=0;60>c;++c)f=document.createElementNS("http://www.w3.org/2000/svg",
"line"),k=c/60*2*Math.PI,m=q,t=.85*q,f.setAttribute("x1",m*Math.sin(k)),f.setAttribute("y1",-m*Math.cos(k)),f.setAttribute("x2",t*Math.sin(k)),f.setAttribute("y2",-t*Math.cos(k)),f.style.strokeWidth=.5,f.style.stroke="black",b().appendChild(f);c=document.createElementNS("http://www.w3.org/2000/svg","line");c.id=a+"Hand";c.setAttribute("x1",0);c.setAttribute("y1",0);c.setAttribute("x2",0);c.setAttribute("y2",.8*-q);c.style.strokeWidth=1.5;c.style.stroke="black";b().appendChild(c);b().style.visibility=
"hidden"})()};function toggleMenu(){var a=document.getElementById("menu-text"),b=document.getElementById("menu-content");"grid"==b.style.display?(b.style.display="none",a.innerHTML='menu <span class="menu-toggle">[+]</span>'):(b.style.display="grid",a.innerHTML='menu <span class="menu-toggle">[-]</span>')};var Game=function(a,b,c){this.currentGameId_=a;this.myUid_=b;this.gameInfo_=c;this.ajaxSequenceHWM_=this.ajaxSequenceLWM_=0;this.pendingSequences_=[];this.initApplication()};Game.prototype.addPendingRequest=function(){++this.ajaxSequenceHWM_;this.pendingSequences_.push(this.ajaxSequenceHWM_);return this.ajaxSequenceHWM_};
Game.prototype.resolveRequest=function(a){a=this.pendingSequences_.indexOf(a);if(-1!=a){this.pendingSequences_.splice(a,1);for(var b=this.ajaxSequenceLWM_+1;b<=this.ajaxSequenceHWM_;++b)if(a=this.pendingSequences_.indexOf(b),-1==a)this.ajaxSequenceLWM_=b;else break;return!0}return!1};
Game.prototype.successWrapper=function(a,b,c){(requestResolved=this.resolveRequest(a))||this.ajaxSequenceHWM_==a?b(c):console.log("Dropped response from an old request: sequence "+a+", lwm "+this.ajaxSequenceLWM_+", hwm "+this.ajaxSequenceHWM_,NaN+this.pendingSequences_.join(", ")+"]")};Game.prototype.failureWrapper=function(a,b,c){this.resolveRequest(a);b(c)};
Game.prototype.get=function(a,b,c){var f=this.ajaxSequenceLWM_;ajaxGet(a,this.successWrapper.bind(this,f,b),this.failureWrapper.bind(this,f,c))};Game.prototype.post=function(a,b,c,f){var q=this.addPendingRequest();ajaxPost(a,b,this.successWrapper.bind(this,q,c),this.failureWrapper.bind(this,q,f))};
Game.prototype.onGameInfoUpdate=function(a){if("fail"==a)alert("Operation failed");else try{var b=JSON.parse(a);b.gameinfo&&("success"!==b.status&&console.log("last update failed"),b=b.gameinfo);this.gameInfo_=b;this.refreshGame()}catch(c){console.log("Unrecognized server response: "+a+". Error: "+c)}};
Game.prototype.parseMoves=function(a){a=a.split("/");for(var b=[],c=1;c<a.length;++c){var f=a[c];if("R"==f||"B"==f)break;b.push([parseInt(f[0],10),parseInt(f[1],10),parseInt(f[2],10),parseInt(f[3],10)])}return b};Game.prototype.moveToString=function(a){return""+a[0]+a[1]+a[2]+a[3]};
Game.prototype.onPlayerMove=function(a,b,c,f){this.gameInfo_.moves+="/"+this.moveToString([a,b,c,f]);this.updateStatus();this.post("/gameinfo","uid="+this.myUid_+"&sid="+getSid()+"&gid="+this.currentGameId_+"&moves="+this.gameInfo_.moves,this.onGameInfoUpdate.bind(this),this.onGameInfoUpdateFailure.bind(this));this.refreshMoveHistoryControls()};Game.prototype.onGameInfoUpdateFailure=function(a){console.log("Retrieve game info failed")};
Game.prototype.requestGameInfo=function(a){this.get("/gameinfo?gid="+a,this.onGameInfoUpdate.bind(this),this.onGameInfoUpdateFailure.bind(this))};Game.prototype.createInviteAILink=function(a){removeAllChildren("invite-ai-container");var b=createLink("invite-ai-link",[],"#",function(){this.inviteAI();return!1}.bind(this),"invite Blur");document.getElementById("invite-ai-container").appendChild(b);a||enableLink("invite-ai-link",!1)};
Game.prototype.sit=function(a){enableLink(a+"-sit-link",!1);this.post("/gameinfo","uid="+this.myUid_+"&sid="+getSid()+"&gid="+this.currentGameId_+"&sit="+a,this.onGameInfoUpdate.bind(this),this.onGameInfoUpdateFailure.bind(this))};Game.prototype.inviteAI=function(){enableLink("invite-ai-link",!1);this.post("/invite_ai","uid="+this.myUid_+"&sid="+getSid()+"&gid="+this.currentGameId_,this.onGameInfoUpdate.bind(this),this.onGameInfoUpdateFailure.bind(this))};
Game.prototype.createHintYou=function(a){var b=document.createElement("sup");b.className="hint-you";a?b.appendChild(document.createTextNode(" ")):b.appendChild(document.createTextNode("you"));return b};
Game.prototype.refreshPlayerList=function(){removeAllChildren("red-player");removeAllChildren("black-player");if(void 0!==this.gameInfo_.red&&null!==this.gameInfo_.red){var a=document.getElementById("red-player"),b=document.createElement("span");b.appendChild(createLink("red-player-link",["player-link"],"/user/"+this.gameInfo_.red.id,void 0,this.gameInfo_.red.name));a.appendChild(b);a.appendChild(this.createHintYou(this.gameInfo_.red.id!=this.myUid_))}else b=createLink("red-sit-link",["sit-link"],
"#",function(){this.sit("red");return!1}.bind(this),"sit here"),document.getElementById("red-player").appendChild(b);void 0!==this.gameInfo_.black&&null!==this.gameInfo_.black?(a=document.getElementById("black-player"),b=document.createElement("span"),b.appendChild(createLink("black-player-link",["player-link"],"/user/"+this.gameInfo_.black.id,void 0,this.gameInfo_.black.name)),a.appendChild(b),a.appendChild(this.createHintYou(this.gameInfo_.black.id!=this.myUid_))):(b=createLink("black-sit-link",
["sit-link"],"#",function(){this.sit("black");return!1}.bind(this),"sit here"),document.getElementById("black-player").appendChild(b))};Game.prototype.gameStarted=function(){return this.gameInfo_.red&&this.gameInfo_.black};
Game.prototype.updateStatus=function(){var a=document.getElementById("waitingStatus"),b=document.getElementById("playingStatus"),c=document.getElementById("redWonStatus"),f=document.getElementById("blackWonStatus");a.style.display="none";b.style.display="none";c.style.display="none";f.style.display="none";this.gameInfo_.moves.endsWith("R")?(c.style.display="inline-block",this.redWatch_.stop(),this.blackWatch_.stop()):this.gameInfo_.moves.endsWith("B")?(f.style.display="inline-block",this.redWatch_.stop(),
this.blackWatch_.stop()):this.gameStarted()?(b.style.display="inline-block",this.board_.isRedNext()?(this.redWatch_.start(),this.blackWatch_.stop()):(this.blackWatch_.start(),this.redWatch_.stop())):a.style.display="inline-block"};Game.prototype.gameInProgress=function(){return this.gameStarted()&&!this.gameInfo_.moves.endsWith("R")&&!this.gameInfo_.moves.endsWith("B")};Game.prototype.appendCellToRow=function(a,b){var c=document.createElement("td");c.appendChild(b);a.appendChild(c)};
Game.prototype.refreshMoveHistoryControls=function(){removeAllChildren("move-history");var a=document.getElementById("move-history"),b=document.createElement("table");b.id="moveHistoryControls";var c=document.createElement("tr");b.appendChild(c);0<this.board_.numMovesShown()?(this.appendCellToRow(c,createLink("move-history-first",[],"#",function(){this.board_.showMove(0);this.refreshMoveHistoryControls();return!1}.bind(this),"first")),this.appendCellToRow(c,createLink("move-history-prev",[],"#",function(){this.board_.showMove(this.board_.numMovesShown()-
1);this.refreshMoveHistoryControls();return!1}.bind(this),"prev"))):(this.appendCellToRow(c,document.createTextNode("first")),this.appendCellToRow(c,document.createTextNode("prev")));this.appendCellToRow(c,document.createTextNode(""+this.board_.numMovesShown()+" / "+this.board_.numMoves()));this.board_.numMovesShown()<this.board_.numMoves()?(this.appendCellToRow(c,createLink("move-history-next",[],"#",function(){this.board_.showMove(this.board_.numMovesShown()+1);this.refreshMoveHistoryControls();
return!1}.bind(this),"next")),this.appendCellToRow(c,createLink("move-history-last",[],"#",function(){this.board_.showMove(this.board_.numMoves());this.refreshMoveHistoryControls();return!1}.bind(this),"last"))):(this.appendCellToRow(c,document.createTextNode("next")),this.appendCellToRow(c,document.createTextNode("last")));a.appendChild(b);document.getElementById("forkGame");removeAllChildren("forkGame");forkGame.appendChild(createLink("move-history-fork-link",[],"/fork/"+this.currentGameId_+"/"+
this.board_.numMovesShown().toString(),void 0,"fork at move "+this.board_.numMovesShown()))};
Game.prototype.refreshGame=function(){this.refreshPlayerList();var a="r";this.gameInfo_.black&&this.gameInfo_.black.id==this.myUid_&&(a="b");var b=this.gameInfo_.black&&this.gameInfo_.black.id==this.myUid_||this.gameInfo_.red&&this.gameInfo_.red.id==this.myUid_;this.board_.setState(a,!this.gameInProgress()||!b,this.parseMoves(this.gameInfo_.moves));this.updateStatus();this.refreshMoveHistoryControls();this.createInviteAILink(b&&(!this.gameInfo_.black||!this.gameInfo_.red))};
Game.prototype.initApplication=function(){this.redWatch_=new Stopwatch("redStopwatch");this.blackWatch_=new Stopwatch("blackStopwatch");window.setInterval(function(){this.redWatch_.tick();this.blackWatch_.tick()}.bind(this),6E4/this.redWatch_.frequency());this.board_=new Board(this.onPlayerMove.bind(this));this.refreshGame();window.setInterval(function(){this.requestGameInfo(this.currentGameId_)}.bind(this),1E3)};
document.onreadystatechange=function(){"interactive"==document.readyState&&new Game(currentGameId,myUid,gameInfo)};
